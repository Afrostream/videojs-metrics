/*! videojs-metrics - v0.0.0 - 2015-10-08
* Copyright (c) 2015 benjipott; Licensed Apache-2.0 */
!function(a,b){"use strict";var c,d,e={option:!0,user_id:"",method:"POST",responseType:"json",timeout:1e3,url:"//stats.afrostream.tv/api/v1/events",trackEvents:["firstplay","ended","waiting","error","bitratechange","dispose"]};d=function(){var a,b,c,d,e={},f=null,g=null,h=null;return a=function(){var a=navigator.userAgent.toLowerCase(),b=/(ie|firefox|chrome|safari|opera)(?:.*version)?(?:[ \/])?([\w.]+)/.exec(a),c=/(mac|win|linux|freebsd|mobile|iphone|ipod|ipad|android|blackberry|j2me|webtv)/.exec(a);a.match(/trident\/7\./)?(f="ie",g=11):b&&b.length>2&&(f=b[1],g=b[2]),c&&c.length>1&&(h=c[1])},b=function(){e.browser=f,e.version=parseInt(g,10)||null,e.os=h},c=function(){"mac"===h&&(h="osx")},d=function(){"safari"===h&&(g=g.substring(0,1))},a(),c(),d(),b(),e};var f=["user_id","type","fqdn"],g={bandwidthIncrease:["video_bitrate","audio_bitrate"],bandwidthDecrease:["video_bitrate","audio_bitrate"],buffering:[],error:["number","message"],start:["os","os_version","web_browser","web_browser_version","resolution_size","flash_version","html5_video","relative_url"],stop:["timeout","frames_dropped"]};c=function(c){var h,i,j,k,l,m,n=b.util.mergeOptions(e,c),o=this,p=d(),q=/https?:\/\/(?:www\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b)*(\/[\/\d\w\.-]*)*(?:[\?])*(.+)*/gi,r=q.exec(o.currentSrc());n.user_id=n.user_id||666,i=function(a){var b={type:a.type};switch(b.type){case"ended":b.type="stop";break;case"firstplay":b.type="start";break;case"waiting":b.type="buffering"}j(b)},h=function(){for(var a=n.trackEvents.length-1;a>=0;a--)o.on(n.trackEvents[a],b.bind(this,i))},l=function(a,b,c){var d={};return"string"==typeof b&&(b=[b]),Object.keys(a).forEach(function(c){b.indexOf(c)>-1&&(d[c]=a[c])},c),d},m=function(a){return f.concat(g[a]||[])},j=function(a){a.user_id=n.user_id,a.fqdn=r[1],a.os=p.os,a.os_version=p.version.toString(),a.web_browser=p.browser,a.web_browser_version=p.web_browser_version,a.resolution_size=screen.width+"x"+screen.height,a.flash_version=b.Flash.version().join(","),a.html5_video="html5"===o.techName,a.relative_url=r[2],a.timeout=!1,a.frames_dropped=0;var c=l(a,m(a.type));k(n,c)},k=function(c,d,e){var f,g,h={method:"GET",timeout:45e3};"function"!=typeof e&&(e=function(){}),"object"==typeof c&&(h=b.util.mergeOptions(h,c),c=h.url);var i=a.XMLHttpRequest;"undefined"==typeof i&&(i=function(){try{return new a.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new a.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new a.ActiveXObject("Msxml2.XMLHTTP")}catch(d){}throw new Error("This browser does not support XMLHttpRequest.")}),f=new i,f.open(h.method,c),f.url=c,f.requestTime=(new Date).getTime(),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.responseType&&(f.responseType=h.responseType),h.withCredentials&&(f.withCredentials=!0),h.timeout&&(g=a.setTimeout(function(){4!==f.readyState&&(f.timedout=!0,f.abort())},h.timeout)),f.onreadystatechange=function(){return 4===this.readyState?(a.clearTimeout(g),f.timedout?e.call(this,"timeout",c):this.status>=400||0===this.status?e.call(this,!0,c):(this.response&&(this.responseTime=(new Date).getTime(),this.roundTripTime=this.responseTime-this.requestTime,this.bytesReceived=this.response.byteLength||this.response.length,this.bandwidth=Math.floor(this.bytesReceived/this.roundTripTime*8*1e3)),e.call(this,!1,c))):void 0};var j="";if("object"==typeof d)for(var k in d)j+=(0===j.length?"":"&")+k+"="+encodeURIComponent(d[k]);return f.send(j),f},h()},b.plugin("metrics",c)}(window,window.videojs);